#! Generated by VisualDCT v2.5
#! DBDSTART
#! DBDEND


# Setting VAL to "stop", stops ALL motorRecord's in this IOC.
# $(P)allstop.VAL is monitored by motorUtil.
record(bo, "$(P)allstop") {
  field(ZNAM, "release")
  field(ONAM, "stop")
  field(DESC, "Stop All IOC motors.")
}

# Monitors the global STOP:ALL PV. When this PV changes, '1' is
# sent to $(P)allstop over channel access.
record(calcout, "$(P)allstop:MONITOR") {
  field(SCAN, ".1 second")
  field(DESC, "Stop All IOC motors.")
  field(INPA, "$(PVPREFIX)CS:MOT:STOP:ALL PP")
  field(OOPT, "On Change")
  field(CALC, "A")
  field(DOPT, "Use OCAL")
  field(OUT, "$(P)allstop.VAL CA")
  field(OCAL, 1)
}

# Indicates if all motors in this IOC are done moving.
# Set by motorUtil when $(P)moving.VAL == 0.
#record(bi, "$(P)alldone") {
# note: have changed from "bi" to "bo" so can push output value properly 
record(bo, "$(P)alldone") {
  field(ZNAM, "moving")
  field(ONAM, "done")
  field(VAL,  "1")
  field(DESC, "All IOC motors done moving.")
  field(OUT, "$(P)_MOVING.A PP")
}

record(calcout, "$(P)_MOVING")
{
  field(SCAN, "Passive")
  field(CALC, "A")
  field(VAL, "1")
  field(OOPT, "On Change")
  field(DOPT, "Use OCAL")
  field(OCAL, "(1-2*A)")
  field(OUT, "$(P)_SEQ.DO1 PP")
}

# need to use an SSEQ with WAIT to make sure we do not loose a PUT
record(sseq, "$(P)_SEQ")
{
    field(LNK1, "$(PVPREFIX)CS:MOT:MOVING:SP CA")
    field(WAIT1, "Wait")
}

# The number of motors moving in this IOC.
# $(P)moving.VAL is set by motorUtil.
record(longout, "$(P)moving") {
  field(DESC, "Motors moving count.")
}

# Used by xxx.adl to blink "Moving" indicator.
#record(calc, "$(P)alldoneBlink") {
#  field(SCAN, ".5 second")
#  field(CALC, "A?0:!B")
#  field(INPA, "$(P)alldone")
#  field(INPB, "$(P)alldoneBlink")
#}

# Allow smart clients to maintain a list of moving motors
record(waveform, "$(P)movingDiff") {
  field(DESC, "Motor w/ last dmov change")
  field(NELM, "62")
  field(FTVL, "CHAR")
}

#! Further lines contain data used by VisualDCT
#! View(50,124,1.3)
#! Record("$(P)allstop",100,343,0,0,"$(P)allstop")
#! Record("$(P)alldone",340,343,0,0,"$(P)alldone")
#! Field("$(P)alldone.VAL",16777215,1,"$(P)alldone.VAL")
#! Visibility("$(P)alldone.DESC",1)
#! Record("$(P)moving",100,490,0,0,"$(P)moving")
#! Record("$(P)alldoneBlink",620,357,0,0,"$(P)alldoneBlink")
#! Field("$(P)alldoneBlink.INPA",16777215,0,"$(P)alldoneBlink.INPA")
#! Link("$(P)alldoneBlink.INPA","$(P)alldone.VAL")
#! Field("$(P)alldoneBlink.VAL",16777215,0,"$(P)alldoneBlink.VAL")
#! Field("$(P)alldoneBlink.INPB",16777215,0,"$(P)alldoneBlink.INPB")
#! Link("$(P)alldoneBlink.INPB","$(P)alldoneBlink.VAL")
#! Visibility("$(P)alldoneBlink.INPA",2)
#! Visibility("$(P)alldoneBlink.INPB",2)
